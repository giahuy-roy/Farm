--[[
---------------------------------------------------------------------
  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—  â–ˆâ–ˆâ•—â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—
 â–ˆâ–ˆâ•”â•â•â•â•â• â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘ â–ˆâ–ˆâ•”â•â•šâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•”â•
 â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•  â•šâ–ˆâ–ˆâ–ˆâ–ˆâ•”â• 
 â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•—   â•šâ–ˆâ–ˆâ•”â•  
 â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•‘   
  â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â• â•šâ•â•â•â•â•â• â•šâ•â•  â•šâ•â•   â•šâ•â•   
---------------------------------------------------------------------
  GiaHuy Fix Lag Hub â€“ Universal Roblox Lag Reducer
  Image Background ID: 100663458322564
  Executor Tested: ArceusÂ XÂ (v2025)
  Features:
   â€¢ Oneâ€‘click FPS & Lag Boost (disables particles, textures, decals, shadowsâ€¦)
   â€¢ Dynamic FPS Cap (30â€‘240)
   â€¢ Lighting Optimizer (Compatibility tech, global fog removal, low shadows)
   â€¢ Water & Terrain simplification
   â€¢ Autoâ€‘Antiâ€‘AFK (prevent kick while idling)
   â€¢ Restore Defaults button
---------------------------------------------------------------------
]]--

repeat task.wait() until game:IsLoaded()

-- // Services & Shortcuts //--------------------------------------------------
local Players          = game:GetService("Players")
local Lighting         = game:GetService("Lighting")
local TweenService     = game:GetService("TweenService")
local RunService       = game:GetService("RunService")
local HttpService      = game:GetService("HttpService")
local ReplicatedStorage= game:GetService("ReplicatedStorage")
local StarterGui       = game:GetService("StarterGui")
local VirtualInput     = game:GetService("VirtualInputManager")
local LocalPlayer      = Players.LocalPlayer

-- // Global Table -------------------------------------------------------------
getgenv().GH_FixLagSettings = {
    Enabled       = false,
    FPSCap        = 90,
    AntiAFK       = true,
    Original      = {}, -- store original settings to restore
}

-- // Helper : Save / Restore Lighting Properties -----------------------------
local function cacheLighting()
    for _,prop in ipairs({"Brightness","FogEnd","Technology","Ambient","OutdoorAmbient"}) do
        GH_FixLagSettings.Original[prop] = Lighting[prop]
    end
end

local function restoreLighting()
    for prop,val in pairs(GH_FixLagSettings.Original) do
        Lighting[prop] = val
    end
end

-- // Core Optimizer Functions -------------------------------------------------
local function disableDescendants()
    -- Remove textures & decals
    for _,v in ipairs(game:GetDescendants()) do
        if v:IsA("Texture") or v:IsA("Decal") or v:IsA("Beam") then
            v.Transparency = 1
        elseif v:IsA("ParticleEmitter") or v:IsA("Trail") or v:IsA("Smoke") then
            v.Enabled = false
        elseif v:IsA("ShirtGraphic") then
            v:Destroy()
        end
    end
end

local function optimizeLighting()
    cacheLighting()
    pcall(function()
        sethiddenproperty(Lighting,"Technology", Enum.Technology.Compatibility)
    end)
    Lighting.Brightness   = 1
    Lighting.GlobalShadows= false
    Lighting.FogEnd       = 1e5
    Lighting.Ambient      = Color3.new(1,1,1)
    Lighting.OutdoorAmbient = Color3.new(1,1,1)
end

local function optimizeTerrain()
    local Terrain = workspace:FindFirstChildOfClass("Terrain")
    if Terrain then
        Terrain.WaterWaveSize = 0
        Terrain.WaterWaveSpeed= 0
        Terrain.WaterReflectance = 0
        Terrain.WaterTransparency = 1
    end
end

local function applyFPSCap(cap)
    if setfpscap then setfpscap(cap) end
end

local function fixLag()
    if GH_FixLagSettings.Enabled then return end
    GH_FixLagSettings.Enabled = true
    disableDescendants()
    optimizeLighting()
    optimizeTerrain()
    applyFPSCap(GH_FixLagSettings.FPSCap)
end

local function restoreGame()
    if not GH_FixLagSettings.Enabled then return end
    GH_FixLagSettings.Enabled = false
    restoreLighting()
    applyFPSCap(240)
    StarterGui:SetCore("SendNotification",{Title="GiaHuy Hub",Text="ÄÃ£ khÃ´i phá»¥c Ä‘á»“ hoáº¡ gá»‘c!",Duration=5})
end

-- // Antiâ€‘AFK -----------------------------------------------------------------
if GH_FixLagSettings.AntiAFK then
    LocalPlayer.Idled:Connect(function()
        VirtualInput:SendMouseButtonEvent(0,0,0,true,game,0)
    end)
end

-- // UI (Kavo) ----------------------------------------------------------------
local Kavo = loadstring(game:HttpGet("https://raw.githubusercontent.com/xHeptc/Kavo-UI-Library/main/source.lua"))()
local Window = Kavo.CreateLib("GiaHuy Fix Lag Hub","BloodTheme")

-- Background image
pcall(function()
    Window.BackgroundImage = "rbxassetid://100663458322564"
end)

local MainTab   = Window:NewTab("Main")
local SettingsTab = Window:NewTab("Settings")

local main = MainTab:NewSection("Boost & Restore")
local set  = SettingsTab:NewSection("Config")

main:NewButton("ğŸš€ Boost FPS & Giáº£m Lag","Táº¯t hiá»‡u á»©ng, tá»‘i Æ°u lighting",function()
    fixLag()
    StarterGui:SetCore("SendNotification",{Title="GiaHuy Hub",Text="Boost FPS thÃ nh cÃ´ng!",Duration=4})
end)

main:NewButton("â™»ï¸ KhÃ´i phá»¥c Ä‘á»“ hoáº¡","Tráº£ láº¡i thiáº¿t láº­p gá»‘c",function()
    restoreGame()
end)

set:NewSlider("Giá»›i háº¡n FPS",240,30,function(v)
    GH_FixLagSettings.FPSCap = v
    if GH_FixLagSettings.Enabled then applyFPSCap(v) end
end)

set:NewToggle("Antiâ€‘AFK", "NgÄƒn kick khi afk", function(b)
    GH_FixLagSettings.AntiAFK = b
end)

-- // Realâ€‘time FPS Display ----------------------------------------------------
local fpsLabel = main:NewLabel("FPS: 0")
local lastTick = tick()
RunService.RenderStepped:Connect(function()
    local dt   = tick() - lastTick
    lastTick   = tick()
    local fps  = math.floor(1/dt)
    fpsLabel:UpdateLabel("FPS: "..fps)
end)

-- // End of Script ------------------------------------------------------------
StarterGui:SetCore("SendNotification",{Title="GiaHuy Hub",Text="Fix Lag Hub Ä‘Ã£ load!",Duration=6})
